# Database Design Documentation

This document describes the details of the design and implementation processes of database related systems.

## Overall Information

The system uses **MongoDB** with **multiple clusters** on the Cloud.

## Data Structures

### Leak

The `Leak` data structure holds the overall information about leakages.

The instances (documents) of this data structure are hold in the collection named `leaks` in the database.

| Field |   Type   |                      Description                     |
|:-----:|:--------:|:----------------------------------------------------:|
|  _id  | ObjectID | The unique object ID generated by the MongoDB server |
|  name |  String  |                The name of the leakage               |

### Email

The `Email` data structure holds the overall information about the emails registered on the system.

The instances (documents) of this data structure are hold in the collection named `emails` in the database.

|    Field   |   Type   |                                                     Description                                                     |
|:----------:|:--------:|:-------------------------------------------------------------------------------------------------------------------:|
|     _id    | ObjectID |                                 The unique object ID generated by the MongoDB server                                |
|    email   |  String  |                                               The email string itself                                               |
|   domain   |  String  | Domain of the email - value of this field is extracted from the email and provided to the DB by the backend service |
| created_at |   Int64  |                            Timestamp of the date that the email was first added to the DB                           |
| updated_at |   Int64  |                        Timestamp of the date that the email was last related to a Leak object                       |

### Relation

The `Relation` data structure holds the `many-to-many` relations between the `Leak` and `Email` data structures.

The instances (documents) of this data structure are hold in the collection named `rels` in the database.

|     Field    |   Type   |                                        Description                                       |
|:------------:|:--------:|:----------------------------------------------------------------------------------------:|
|      _id     | ObjectID |                   The unique object ID generated by the MongoDB server                   |
|   email_id   | ObjectID |                        The unique object ID of the Email specified                       |
|    leak_id   | ObjectID |                        The unique object ID of the Leak specified                        |
| email_domain |  String  | The domain of the email specified - this field is used for the find-by-domain operations |

## Security

The backend service **forces** the clusters to use `SSL/TLS` on the communications.

## Architectural Design Decisions

I've decided to use **MongoDB** as the database for several reasons.

Firstly, as I am using gRPC as a **microservice** in cloud (**lambda** functions), I had to use a **cloud database** too. MongoDB has its own well-documented and served cloud database solution: Atlas.

Also in MongoDB Atlas it's very easy to manage **multi-clustered** databases. This is also beneficial in the means of **performance**.

Lastly, the data structure described in the project definition was not fully-structured, the data structures can change in time. For example the `domain` field of the `Email` object can be extracted and be a standalone object itself. A **NoSQL** database is right for that kind of situations.